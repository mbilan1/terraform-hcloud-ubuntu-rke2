# ──────────────────────────────────────────────────────────────────────────────
# SAST: KICS
#
# Checkmarx KICS — infrastructure-as-code vulnerability scanner.
# Badge: SAST: KICS
# ──────────────────────────────────────────────────────────────────────────────

name: "SAST: KICS"

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  kics:
    name: KICS scan
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Run KICS scan
        shell: bash
        # NOTE: Exclude examples/simple-setup/ — contains demo K8s workload YAML files
        # (load_example.yaml, gateway_example.yaml, standard-install.yaml) with 200+
        # K8s security findings. These are reference manifests, not module code.
        run: |
          docker run --rm \
            -v "${PWD}:/path" \
            checkmarx/kics:latest scan \
            -p /path \
            --exclude-paths "/path/.terraform,/path/.git,/path/examples/simple-setup" \
            --exclude-queries "a88baa34-e2ad-44ea-ad6f-8cac87bc7c71" \
            --fail-on high,critical
